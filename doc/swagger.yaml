openapi: 3.0.0

servers:
  - url: //example.legend.io/api/v1
    description: Default server
info:
  description: |
    # Introduction
    Cases API Spec for the legend, naive now. 
  version: "0.0.2"
  title: The Legend
  contact:
    name: API Support
    email: xuylin@sjtu.edu.cn
    url: 'https://github.com/linxuyalun'
  x-logo:
    url: 'http://5b0988e595225.cdn.sohucs.com/images/20181027/083e04d73d074e319853323b645b0041.jpeg'
    altText: The Legned logo
  license:
    name: Apache 2.0
    url: 'http://www.apache.org/licenses/LICENSE-2.0.html'

tags:
  - name: cases
    description: >-
      A bankruptcy case is created by a practitioner, and every case is unique.
      All information can be seen in the case.

paths:         
  '/cases':
    post:
      tags:
        - cases
      summary: launch a new case
      description: >-
        Practitioners can launch a new case. 
        When a new case is createrd, the remaining workflow is case-driven.
      security:
        - BearerAuth: []
      responses:
        '200':
          $ref: '#/components/responses/CreateCaseResponse'
      requestBody:
        $ref: '#/components/requestBodies/CaseInfo'
  
  '/cases/{case_id}':
    get:
      tags:
        - cases
      summary: basic information of the specific case
      parameters:
        - name: case_id
          in: path
          description: uuid of the case
          required: true
          schema:
            type: string
            format: uuid
            example: 550e8400-e29b-41d4-a716-446655440000
      description: >-
        Basic information of the specific case will be shown.
        It will return different roll based on the token
      security:
        - BearerAuth: []
      responses:
        '200':
          $ref: '#/components/responses/CaseInfoResponse'

  '/cases/{case_id}/info-table':
    parameters:
      - name: case_id
        in: path
        description: uuid of the case
        required: true
        schema:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000 
    get:
      tags:
        - cases
      security:
        - BearerAuth: []
      summary: get the case information table
      description: >-
        It will return the download url of the case information table.
        Many information of the case will be recoded in the table.     
      responses:
        '200':
          $ref: '#/components/responses/InfoTableResponse'  
    post:
      tags:
        - cases
      security:
        - BearerAuth: []
      summary: upload the case information table
      description: >-
        upload the case information table.   
      responses:
        '200':
          $ref: '#/components/responses/NormalResponse'
      requestBody:
        description: information of initiate a case
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                case_info_table:
                  type: string
                  description: the case info table url

  '/practitioners/cases-invitation':  
    get:
      tags:
        - cases
      security:
        - BearerAuth: []
      summary: Return all the cases the practitioner invited.
      description: >-
        A practitioner can receive the invitation and check the case basic information. 
        This will return the cases the practitioner hasn't passed the invitation yet.
      responses:
        '200':
          $ref: '#/components/responses/CaseInvitationResponse'

  '/cases/{case_id}/accept':
    parameters:
      - name: case_id
        in: path
        description: uuid of the case
        required: true
        schema:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
    get:
      tags:
        - cases
      security:
        - BearerAuth: []
      summary: The practitioner accept the invitation.
      description: >-
        A practitioner accept the invitation
      responses:
        '200':
          $ref: '#/components/responses/NormalResponse'
  
  '/cases/{case_id}/invitation':
    parameters:
      - name: case_id
        in: path
        description: uuid of the case
        required: true
        schema:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
    post:
      tags:
        - cases
      security:
        - BearerAuth: []
      summary: Invite other practitioners to join the case.
      description: >-
        When invite other practitioners, the manager also need to assign a role to every practitioner.  
      responses:
        '200':
          $ref: '#/components/responses/NormalResponse'
      requestBody:
        description: an array of the practitioner registration code
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                registration_codes:
                  type: array
                  items:
                    type: object
                    properties:
                      registration_code:
                        type: string
                        example: todo
                      roll:
                        description: the roll of the practitioner
                        type: string
                        enum:
                          - manager
                          - visitor
                          - other
  
  '/cases/{case_id}/credetors/claim-information':
    parameters:
      - name: case_id
        in: path
        description: uuid of the case
        required: true
        schema:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
    post:
      tags:
        - cases
      summary: 5.2 Creditor adds claim information
      description: Add claim information of a creditor
      security:
        - BearerAuth: []
      responses:
        '200':
          $ref: '#/components/responses/NormalResponse'
      requestBody:
        $ref: '#/components/requestBodies/CredetorClaimInfo'
                    
  '/cases/{case_id}/credetors/claim-evidence':
    parameters:
      - name: case_id
        in: path
        description: uuid of the case
        required: true
        schema:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
    post:
      tags:
        - cases
      summary: 5.3 Creditor adds claim evidence.
      description: |
        Add claim evidence of a creditor
        There may be several documents, and each document's format is the same.
        Back end needs to generate an id for every claim evidence doc.
      security:
        - BearerAuth: []
      responses:
        '200':
          $ref: '#/components/responses/NormalResponse'
      requestBody:
        $ref: '#/components/requestBodies/CredetorClaimEvidence'
  
  '/cases/{case_id}/practitioners/manager/get-claim-evidences':
    parameters:
      - name: case_id
        in: path
        description: uuid of the case
        required: true
        schema:
          type: string
          format: uuid
          example: 550e8400-e29b-41d4-a716-446655440000
    get:
      tags:
        - cases
      summary: 6.3 Return claim evidences of the case
      description: |
        A manager needs to check credetors' claim evidences.
        To do so, back end should first check the corresponding credetors of a spec manager.
        Then return all claim evidences of the credetor.
        Note that every manager has different credetors.
      security:
        - BearerAuth: []
      responses:
        '200':
          $ref: '#/components/responses/ClaimEvidenceListResponse'    

  '/cases/{case_id}/practitioners/manager/':
  
components:
  schemas:
    Error:
      type: object
      properties:
        status_code:
          description: invalid operation
          type: integer
          enum:
            - 401
            - 403
            - 409
        message:
          type: string
          example: Invalid operation!
    
    MessageOnly:
      type: object
      properties:
        status_code:
          description: successful operation
          type: integer
          enum:
            - 200
        message:
          type: string
          example: Valid operation!
       
    200InfoTable:
      type: object
      properties:
        status_code:
          description: successful operation
          type: integer
          enum:
            - 200
        message:
          type: string
          example: Get case info table successfully!
        body:
          type: object
          properties:
            download_field:
              description: |
                The download field of the case information table.
                field can be nullable.
              type: string
              nullable: true   

    200CaseInfo:
      type: object
      properties:
        status_code:
          description: successful operation
          type: integer
          enum:
            - 200
        message:
          type: string
          example: initiate case successfully!
        body:
          $ref: '#/components/schemas/CaseInfo'

    200CaseId:
      type: object
      properties:
        status_code:
          description: successful operation
          type: integer
          enum:
            - 200
        message:
          type: string
          example: initiate case successfully!
        body:
          type: object
          properties:
            case_id:
              description: the only id of the case
              type: string
              format: uuid
              example: 550e8400-e29b-41d4-a716-446655440000  
    
    200RecieveInvitationResponse:
      type: object
      properties:
        status_code:
          description: successful operation
          type: integer
          enum:
            - 200
        message:
          type: string
          example: receive invitation successfully!
        body:
          type: object
          properties:          
            case_info:
              type: array
              nullable: true
              items:
                allOf:
                  - type: object
                    properties:
                      case_id:
                        type: string
                        format: uuid
                        example: 550e8400-e29b-41d4-a716-446655440000
                  - $ref: '#/components/schemas/CaseInfo'
     
    200ClaimEvidenceListResponse:
      type: object
      properties:
        status_code:
          description: successful operation
          type: integer
          enum:
            - 200
        message:
          type: string
          example: receive invitation successfully!
        body:
          type: object
          properties:
            redectors:
              type: array
              nullable: true
              items:
                type: object
                properties:
                  todo:
                    example: todo
                  
    
    Debtor:
      type: object
      properties:
        company_name:
          type: string
          example: alibaba
        credit_number:
          type: string
          description: Credit No. is the unique id for a company
          example: "3829472048295672049"
        address:
          type: string
          description: address is the address of the registered address of the company
          example: 800 Dongchuan Road, Minhang District, Shanghai, China
        business_scope:
          type: string
          example: clothes
        registered_capital:
          type: string
          example: 5 millions
        subscribed_capital:
          type: string
          example: 3 millions
        establishment_day:
          type: string
          example: 2016/05/26
        company_contact:
          type: string
          example: "5385470"
        registration_authority:
          type: string
          example: Shanghai Trade and Industry Bureau
        legal_representative:
          type: object
          description: the legal representative for the company
          properties:
            name:
              type: string
              example: john cena
            credentials_number:
              type: string
              description: credentials' number
              example: "533527198909210238"
            phone:
              type: string
              example: "13822098739"
          
    Trustee:
      description: A trustee is a person or firm that holds or administers property or assets for the benefit of a third party
      type: object
      properties:
        name:
          type: string
          description: name of trustee
          example: Dan
        credentials_number:
            type: string
            description: credentials' number
            example: "533527198909210238"
        company:
          type: string
          description: the company user works for
          example: alibaba
        company_contact:
          type: string
          description: the phone number of the company
          example: "5385470"
        address:
          type: string
          description: address is the address of the trustee
          example: 800 Dongchuan Road, Minhang District, Shanghai, China
        
    
    CompanyApplicant:
      description: The applicant is a company
      allOf:
        - $ref: '#/components/schemas/Applicant'
        - type: object
          properties:
            company_name:
              type: string
              example: alibaba
            credit_number:
              type: string
              description: Credit No. is the unique id for a company
              example: "3829472048295672049"
            legal_representative:
              description: the legal representative for the company
              type: string
              example: john cena
            address:
              type: string
              description: address is the address of the registered address of the company
              example: 800 Dongchuan Road, Minhang District, Shanghai, China
            company_contact:
              type: string
              example: "5385470"
            trustee:
              $ref: '#/components/schemas/Trustee'
    
    NaturalPersonApplicant:
      description: The applicant is a natural person
      allOf:
        - $ref: '#/components/schemas/Applicant'
        - type: object
          properties:
            natural_person_name:
              type: string
              example: Nakamura
            credentials_number:
              type: string
              description: credentials' number
              example: "533527198909210238"
            phone:
              type: string
              description: the phone number of the company
              example: "13923456728"
            address:
              type: string
              description: address is the address of the natural person
              example: 800 Dongchuan Road, Minhang District, Shanghai, China
            trustees:
              type: array
              minLength: 1
              maxLength: 4
              items:
                $ref: '#/components/schemas/Trustee'
            
    Applicant:
      type: object
      description: the person who want to launch the case
      discriminator:
        propertyName: applicant_type
        mapping:
          company: '#/components/schemas/CompanyApplicant'
          natural_person: '#/components/schemas/NaturalPersonApplicant'
      properties:
        application_type:
          description: type of the application
          type: string
          enum:
            - creditor-application
            - debtor-application
            - shareholder-application
        applicant_type:
          description: type of the applicant
          type: string
        
    Court:
      type: object
      description: information of the court
      properties:
        name:
          type: string
          example: the Higher People's Court of Shanghai
        address:
          type: string
          description: address of the court
          example: 1200 Hongqiao Road, Changning District, Shanghai, China
        contact:
          type: string
          description: court contact
          example: "021-34254567"
        presiding_judge:
          $ref: '#/components/schemas/CompanyApplicant'
        collegial_panel_members:
          type: array
          minLength: 1
          items:
            $ref: '#/components/schemas/CompanyApplicant'
        judge_assistants:
          type: array
          minLength: 1
          items:
            $ref: '#/components/schemas/CompanyApplicant'
        clerks:
          type: array
          minLength: 1
          items:
            $ref: '#/components/schemas/CompanyApplicant'
      
    CourtMembersInfo:
      description: basic information of a court member
      type: object
      properties:
        name:
          type: string
          example: Shinsuke Nakamura
        phone:
          type: string
          nullable: true
          example: "13920042013"
        fixed_line:
          type: string
          nullable: true
          example: "5385479"
    
    CaseInfo:
      description: basic information of the case
      type: object
      properties:
        id:
          type: string
          description: the real-world id of the case
          example: "(2011) the second court No. 92"
        acceptance_time:
          type: string
          description: Acceptance Time Of The Court (Arbitral Authority)
          example: 2018/08/24
        first_meeting_point:
          type: string
          example: 2019/01/01
        second_meeting_point:
          type: string
          example: 2019/02/02
        todo:
          type: string
          example: todo
    
    ManagerInfo:
      description: basic information of the case manager
      properties:
        responsible_body_full_name:
          type: string
          description: Full name of the responsible body
          example: The legend Manager
        principal:
          type: string
          description: the principal of the responsible body
          example: Batista
        contact:
          type: string
          description: contact of the manager
          example: "56798420"
        address:
          type: string
          description: the contact address of the manager
          example: "4 Chome-3-11 Shiba, Minato City, Tokyo 108-0014"
          
    LiquidationTeamAsManager:
      description: The liquidation team is composed of several natural persons, which may be in different companies.
      allOf:
        - $ref: '#/components/schemas/ManagerMembers'
        - type: object
          properties:
            liquidation_team_members:
              type: array
              items:
                type: object
                properties:
                  name:
                    type: string
                    description: the name of the liquidation team member
                    example: Yong
                  company:
                    type: string
                    description: the company the liquidation team member is in
                    example: alibaba

    SingleAgencyAsManager:
      description: The manager is actually a single agency.
      allOf:
        - $ref: '#/components/schemas/ManagerMembers'
        - type: object
          properties:
            agency_name:
              type: string
              example: The legend Agency

    MulAgenciesAsManager:
      description: The managers are composed of multiple agencies.
      allOf:
        - $ref: '#/components/schemas/ManagerMembers'
        - type: object
          properties:
            agencies_name:
              type: array
              items:
                type: string
                example: the Legend Agency
    
    NaturalPersonAsManager:
      description: The manager is actually a single natural person.
      allOf:
        - $ref: '#/components/schemas/ManagerMembers'
        - type: object
          properties:
            natural_person_name:
              type: string
              description: the name of the natural person
              example: Yong
            natural_person_company:
              type: string
              description: the company the natural person is in
              example: alibaba
    
    ManagerMembers:      
      type: object
      description: the manager composition model and basic information of manager members
      discriminator:
        propertyName: composition_model
        mapping:
          liquidation_team: '#/components/schemas/LiquidationTeamAsManager'
          single_agency: '#/components/schemas/SingleAgencyAsManager'
          mul_agencies: '#/components/schemas/MulAgenciesAsManager'
          natural_person: '#/components/schemas/NaturalPersonAsManager'
      properties:
        composition_model:
          description: type of the manager composition
          type: string

    CompanyClaimInfo:
      type: object
      properties:
        company:
          description: information of the company
          type: object
          properties:
            type:
              type: string
              example: clothes
            address:
              type: string
              example: 800 Dongchuan Road, Minhang District, Shanghai, China
            email:
              type: string
              example: alibaba@alimama.com
            fax_number:
              type: string
              example: "0592-88887777"
        legal_representative:
          description: information of the legal
          type: object
          properties:
            name:
              type: string
              example: Randy Orton
            position:
              type: string
              example: CFO
            credentials_number:
              type: string
              description: credentials' number
              example: "533527198909210238"
            phone:
              type: string
              example: "13325473479"
            fixed_line:
              type: string
              example: "021-54678924"
              nullable: true
            address:
              type: string
              example: 800 Dongchuan Road, Minhang District, Shanghai, China         

    NaturalPersonClaimInfo:
      type: object
      properties:
        address:
          type: string
          example: 800 Dongchuan Road, Minhang District, Shanghai, China
        phone:
          type: string
          description: |
            it's strange here. 
            When creditor registers, he/she needs to fill in phone
            Needs to be confirmed.
          example: Needs to be confirmed.
        email:
          type: string
          example: alibaba@alimama.com


         
  requestBodies:    
    CredetorClaimInfo:
      description: >-
        Claim information of a credetor. 
        A case may have many credetors.
        Every credetor in a case has claim information.
      required: true
      content:
        application/json:
          schema:
            type: object
            allOf:
              - type: object
                properties:
                  credetor_specific_type:
                    description: specific type of a credetor, multiple choice.
                    type: array
                    minLength: 1
                    items:
                      type: string
                      enum: 
                        - financing
                        - operating
                        - public-utility
                        - intermediary-service
                        - others
                        - todo
                  trustees:
                    type: array
                    nullable: true
                    description: Needs to be confirmed.
                    items:
                      type: string
                      example: todo
                  bank_account:
                    type: object
                    description: bank account information of a credetor
                    properties:
                      beneficiary:
                        type: string
                        description: |
                          Beneficiary is the bank account name.
                          By default the beneficiary is the same as company name or natural person name.
                          If the credetor is natural person, beneficiary must be the same as natural person name.
                          If the credetor is company, beneficiary can be different.
                          Back end needs to specially mark this situation.
                      bank:
                        type: string
                        example: Bank of China, Chengjiang Office
                      bank_code:
                        type: string
                        example: "305100001016"
                      account_number:
                        type: string
                        example: "33265805054885"
                      files:
                        type: object
                        properties:
                          todo:
                            example: todo
              - oneOf:
                - $ref: '#/components/schemas/CompanyClaimInfo'
                - $ref: '#/components/schemas/NaturalPersonClaimInfo'

    CredetorClaimEvidence:
      description: >-
        The credetor fills in the claim evidence document.
        There may be several documents, and each document's format is the same.
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              claim_property:
                type: string
                enum:
                  - normal-claim
                  - property-secured-claim
                  - tax-claim
                  - employee-claim
                  - others
              claim_amount:
                type: object
                properties:
                  currency:
                    type: string
                    default: rmb
                  principal:
                    type: string
                    example: 10,000,000
                  interest:
                    type: string
                    example: "0.005"
                  liquidated_damages:
                    type: string
                    example: "8792"
                  litigation_costs:
                    type: string
                    example: "100"
                  laywer_fee:
                    type: string
                    example: "100.99"
                  execution_fee:
                    type: string
                    example: "200"
                  others:
                    type: string
                    example: "100"
              contract_situation:
                type: object
                properties:
                  todo:
                    example: todo
              todo:
                example: 财产担保情况, 有无诉讼或仲裁, 有无查封冻结
              files:
                description: the corresponding file of the above
                type: object
                properties:
                  todo:
                    example: todo, 具体要上传的文件待确定

    CaseInfo:
      description: information of initiate a case
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              case_type:
                type: string
                enum:
                  - A
                  - B
                  - C
                  - D
                  - E
              contact:
                type: object
                description: the public contact of the case
                properties:
                  name:
                    type: string
                    description: name of the contact
                    example: Adam Cole
                  phone:
                    type: string
                    example: "13278302983"
                  fixed_line:
                    type: string
                    example: "021-54678924"
                    nullable: true
              debtor:
                $ref: '#/components/schemas/Debtor'
              applicant:
                $ref: '#/components/schemas/Applicant'
              court:
                $ref: '#/components/schemas/Court'
              case_info:
                $ref: '#/components/schemas/CaseInfo'
              manager_info:
                $ref: '#/components/schemas/ManagerInfo'
              manager_members:
                $ref: '#/components/schemas/ManagerMembers'
              files:
                type: object
                properties:
                  todo:
                    type: string
                    example: todo
              toll:
                type: object
                properties:
                  todo:
                    type: string
                    example: todo


  responses:
    NormalResponse:
      description: normal response object
      content:
        application/json:
          schema:
            oneOf:
              - $ref: '#/components/schemas/MessageOnly'
              - $ref: '#/components/schemas/Error'

    InfoTableResponse:
      description: case information table response object
      content:
        application/json:
          schema:
            oneOf:
              - $ref: '#/components/schemas/200InfoTable'
              - $ref: '#/components/schemas/Error'
    
    CaseInfoResponse:
      description: basic information of the case
      content:
        application/json:
          schema:
            oneOf:
              - $ref: '#/components/schemas/200CaseInfo'
              - $ref: '#/components/schemas/Error'

    CreateCaseResponse:
      description: return the uuid of the case
      content:
        application/json:
          schema:
            oneOf:
              - $ref: '#/components/schemas/200CaseId'
              - $ref: '#/components/schemas/Error'
    
    CaseInvitationResponse:
      description: return the invitation response, including case basic information.
      content:
        application/json:
          schema:
            oneOf:
              - $ref: '#/components/schemas/200RecieveInvitationResponse'
              - $ref: '#/components/schemas/Error'

    ClaimEvidenceListResponse:
      description: return the credetors' list response.
      content:
        application/json:
          schema:
            oneOf:
              - $ref: '#/components/schemas/200ClaimEvidenceListResponse'
              - $ref: '#/components/schemas/Error'

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT